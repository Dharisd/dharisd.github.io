<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Real-time Vehicle Detection and Speed Estimation using YOLO and Deepsort : Part II - dharisd's blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="New features added pushing image detections to db How? The Detection object already has a list of features for the detections, So what needs to be done is for the Detection object to also have a list image crops of the detections taken using the Bounding box Data from the model.
This is done by adding a function to crop the detections and add to the Detections object
def _get_im_crops(self, bbox_xywh, ori_img): im_crops = [] for box in bbox_xywh: x1,y1,x2,y2 = self."><meta property="og:image" content><meta property="og:title" content="Real-time Vehicle Detection and Speed Estimation using YOLO and Deepsort : Part II"><meta property="og:description" content="New features added pushing image detections to db How? The Detection object already has a list of features for the detections, So what needs to be done is for the Detection object to also have a list image crops of the detections taken using the Bounding box Data from the model.
This is done by adding a function to crop the detections and add to the Detections object
def _get_im_crops(self, bbox_xywh, ori_img): im_crops = [] for box in bbox_xywh: x1,y1,x2,y2 = self."><meta property="og:type" content="article"><meta property="og:url" content="https://dharisd.github.io/posts/vehicle-monitor-part-two/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-16T18:57:46+05:00"><meta property="article:modified_time" content="2023-01-16T18:57:46+05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Real-time Vehicle Detection and Speed Estimation using YOLO and Deepsort : Part II"><meta name=twitter:description content="New features added pushing image detections to db How? The Detection object already has a list of features for the detections, So what needs to be done is for the Detection object to also have a list image crops of the detections taken using the Bounding box Data from the model.
This is done by adding a function to crop the detections and add to the Detections object
def _get_im_crops(self, bbox_xywh, ori_img): im_crops = [] for box in bbox_xywh: x1,y1,x2,y2 = self."><script src=https://dharisd.github.io/js/feather.min.js></script>
<link href=https://dharisd.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://dharisd.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://dharisd.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css></head><body><div class=content><header><div class=main><a href=https://dharisd.github.io/>dharisd's blog</a></div><nav><a href=/posts>Home</a>
<a href=/posts>posts</a>
<a href=/about>About</a></nav></header><main><article><div class=title><h1 class=title>Real-time Vehicle Detection and Speed Estimation using YOLO and Deepsort : Part II</h1><div class=meta>Posted on Jan 16, 2023</div></div><section class=body><h4 id=new-features-added>New features added</h4><p><img src=https://raw.githubusercontent.com/Dharisd/dharisd.github.io/main/assets/images/part_two_min.png alt=web-dashboard></p><ul><li>pushing image detections to db</li></ul><h4 id=how>How?</h4><p>The Detection object already has a list of features for the detections, So what needs to be done is for the Detection object to also have a list image crops of the detections taken using the Bounding box Data from the model.</p><p>This is done by adding a function to crop the detections and add to the Detections object</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_get_im_crops</span>(self, bbox_xywh, ori_img):
</span></span><span style=display:flex><span>        im_crops <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> box <span style=color:#f92672>in</span> bbox_xywh:
</span></span><span style=display:flex><span>            x1,y1,x2,y2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_xywh_to_xyxy(box)
</span></span><span style=display:flex><span>            im <span style=color:#f92672>=</span> ori_img[y1:y2,x1:x2]
</span></span><span style=display:flex><span>            im_crops<span style=color:#f92672>.</span>append(im)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> im_crops
</span></span></code></pre></div><p>Then when the vehicle has passed, and is added to the list of tracks to be deleted,
before deleting , The image crop at the middle index of the img_crop is taken ,</p><h4 id=why-mid>Why mid?</h4><ul><li>The highest chance of getting cleanest and largest image</li></ul><p>Although it might be possible to calculate the largest bounding box and then choose it, I decided to keep it simple .The array for the crop is converted to a JPEG image, base64 encoded and send to the API,The image data is kept in MongoDB itself</p><h4 id=why>Why?</h4><ul><li>Easy and the detecions are small in size
Small change added to API to only send the img data when the img parameter is set to true
to make the dashboard loads faster, Since only the Detailed Detection page only needs it</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>        <span style=color:#66d9ef>if</span> orderby <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;speed&#34;</span>:
</span></span><span style=display:flex><span>            pass_output <span style=color:#f92672>=</span> list(db[<span style=color:#e6db74>&#34;vehiclepasses&#34;</span>]<span style=color:#f92672>.</span>find({},{<span style=color:#e6db74>&#34;img_data&#34;</span>:<span style=color:#ae81ff>0</span>},limit<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>)<span style=color:#f92672>.</span>sort(<span style=color:#e6db74>&#34;speed&#34;</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> img:
</span></span><span style=display:flex><span>            pass_output <span style=color:#f92672>=</span> list(db[<span style=color:#e6db74>&#34;vehiclepasses&#34;</span>]<span style=color:#f92672>.</span>find(limit<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>)<span style=color:#f92672>.</span>sort(<span style=color:#e6db74>&#34;timestamp&#34;</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            pass_output <span style=color:#f92672>=</span> list(db[<span style=color:#e6db74>&#34;vehiclepasses&#34;</span>]<span style=color:#f92672>.</span>find({},{<span style=color:#e6db74>&#34;img_data&#34;</span>:<span style=color:#ae81ff>0</span>},limit<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>)<span style=color:#f92672>.</span>sort(<span style=color:#e6db74>&#34;timestamp&#34;</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>))
</span></span></code></pre></div><h3 id=code>Code</h3><p>Modified :HowieMa/DeepSORT_YOLOv5_Pytorch": <a href=https://github.com/Dharisd/DeepSORT_YOLOv5_Pytorch>https://github.com/Dharisd/DeepSORT_YOLOv5_Pytorch</a></p><p>Backend API: <a href=https://github.com/Dharisd/logging-api>https://github.com/Dharisd/logging-api</a></p></section><div class=post-tags></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/dharisd rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/dharissss/ rel=me title=Twitter><i data-feather=twitter></i></a>
<a class=border></a></div><div class=footer-info>2023 Â© Dharis |</div></footer><script>feather.replace()</script></div></body></html>