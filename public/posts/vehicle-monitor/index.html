<!DOCTYPE html>
<html><head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Real-time Vehicle Detection and Speed Estimation using YOLO and Deepsort - dharisd&#39;s blog</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Having a good view of the road infront and extra android phone laying around
I wondered
can i log very passing vehicle? can i get their types (car,motorbike,truck)? can i get their speed? can i visualize how busy the and generate live reports based on the logged data? if so that would look darn cool
![[Screenshot 2022-11-14 at 00.30.58.png]]
This could technically be acheived through
live stream of the road server to process the stream and run object detection and tracking backend to save the data Frontend to do cool visuals But how ?" />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="Real-time Vehicle Detection and Speed Estimation using YOLO and Deepsort" />
<meta property="og:description" content="Having a good view of the road infront and extra android phone laying around
I wondered
can i log very passing vehicle? can i get their types (car,motorbike,truck)? can i get their speed? can i visualize how busy the and generate live reports based on the logged data? if so that would look darn cool
![[Screenshot 2022-11-14 at 00.30.58.png]]
This could technically be acheived through
live stream of the road server to process the stream and run object detection and tracking backend to save the data Frontend to do cool visuals But how ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dharisd.github.io/posts/vehicle-monitor/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-29T11:26:00+05:00" />
<meta property="article:modified_time" content="2022-11-29T11:26:00+05:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Real-time Vehicle Detection and Speed Estimation using YOLO and Deepsort"/>
<meta name="twitter:description" content="Having a good view of the road infront and extra android phone laying around
I wondered
can i log very passing vehicle? can i get their types (car,motorbike,truck)? can i get their speed? can i visualize how busy the and generate live reports based on the logged data? if so that would look darn cool
![[Screenshot 2022-11-14 at 00.30.58.png]]
This could technically be acheived through
live stream of the road server to process the stream and run object detection and tracking backend to save the data Frontend to do cool visuals But how ?"/>
<script src="https://dharisd.github.io/js/feather.min.js"></script>
	
	
        <link href="https://dharisd.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://dharisd.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://dharisd.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css"   />
	
	
	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://dharisd.github.io/">dharisd&#39;s blog</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/posts">All posts</a>
		
		<a href="/about">About</a>
		
		<a href="/tags">Tags</a>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">Real-time Vehicle Detection and Speed Estimation using YOLO and Deepsort</h1>
			<div class="meta">Posted on Nov 29, 2022</div>
		</div>
		

		<section class="body">
			<p>Having a good view of the road infront and extra android phone laying around</p>
<p>I wondered</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>can i log very passing vehicle?
</span></span><span style="display:flex;"><span>can i get their types (car,motorbike,truck)?
</span></span><span style="display:flex;"><span>can i get their speed?
</span></span><span style="display:flex;"><span>can i visualize how busy the
</span></span></code></pre></div><p>and generate live reports based on the logged data? if so that would look darn cool</p>
<p>![[Screenshot 2022-11-14 at 00.30.58.png]]</p>
<p>This could technically be acheived through</p>
<ul>
<li>live stream of the road</li>
<li>server to process the stream and run object detection and tracking</li>
<li>backend to save the data</li>
<li>Frontend to do cool visuals</li>
</ul>
<h2 id="but-how-">But how ?</h2>
<h4 id="camera-for-live-stream">camera for live stream</h4>
<p>For this i just used my old android device and ran one of the mulitple ip camera apps available to get an RTSP stream from the device on to my laptop</p>
<p>blog_v3/assets/images/Screenshot 2022-12-07 at 09.21.04.png</p>
<h4 id="how-do-i-detect-from-this">How do i detect from this?</h4>
<p>Technically it would be possible to get a</p>
<ul>
<li>count of number of vehicles on road</li>
<li>classes of detections</li>
</ul>
<p>If I just run an object recognition model such as YOLO periodically on frames of the livestream. This method cannot track or identify detections across multiple frames. This prevents me from getting important data such as getting the speed of passing vehicles</p>
<h4 id="so">so?</h4>
<p>Enter <a href="https://arxiv.org/abs/1703.07402">Deepsort</a>. Deepsort allows to track detections across frames. This means that we can track a car and get its path from when it enters the frame to when it disappears from frame, as in in we can get the rough speed of the vehicle&rsquo;s pass, with code as simple as</p>
<p>![[Screenshot 2022-11-18 at 18.16.33.png]]</p>
<p>Fortunately <a href="%5Bhttps://github.com/HowieMa/DeepSORT_YOLOv5_Pytorch%5D">this</a> exists, i just had to make a few modifications to make it spit out the tracks of vehicles right before it gets deleted</p>
<p>blog_v3/assets/images/Screenshot 2022-12-07 at 10.23.37.png</p>
<p><strong>Easy and done right? nope</strong></p>
<p>Saving the data to the backend would require me to do a blocking HTTP API call, and if we are to run this in realtime this must be done with in the detection loop , obviously not good?</p>
<p>So how do we not block the detection loop but still make it output data while its running?</p>
<h2 id="we-use-python-queues">We use Python Queues</h2>
<p>start a worker in another thread</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> queue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>Queue()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">worker</span>():
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		data <span style="color:#f92672">=</span> q<span style="color:#f92672">.</span>get()
</span></span><span style="display:flex;"><span>		requests<span style="color:#f92672">.</span>post(<span style="color:#e6db74">&#34;http://178.128.28.91:8000/store-pass&#34;</span>, json<span style="color:#f92672">=</span>data)
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Working on </span><span style="color:#e6db74">{</span>data<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Finished </span><span style="color:#e6db74">{</span>data<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>		q<span style="color:#f92672">.</span>task_done()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">#start the thread</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#less go</span>
</span></span></code></pre></div><p>Then start an instance of this worker in another thread</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>worker, daemon<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)<span style="color:#f92672">.</span>start()
</span></span></code></pre></div><p>And then we can simply add to this queue with</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>q<span style="color:#f92672">.</span>put()
</span></span></code></pre></div><p>Whats next is to simply store the data and show it in interesting way</p>
<h3 id="backend">Backend</h3>
<p>Backend is quite simple and is bulit using FastAPI and mongoDB to save data</p>
<h3 id="frontend">Frontend</h3>
<p>For frontend i just modified <a href="https://github.com/themesberg/tailwind-dashboard-windster/">this very cool dashboard</a> and just added the relevent fields, and some simple JS for fetching (needs improvement).</p>

		</section>

		<div class="post-tags">
			
			
			
		</div>
	</article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/dharisd" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a><a class="soc" href="https://twitter.com/dharissss/" rel="me" title="Twitter"><i data-feather="twitter"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2022  © Dharis |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
  feather.replace()
</script></div>
    </body>
</html>
